{"version":3,"sources":["Services/Entities/FieldConfigurationsService.ts"],"names":[],"mappings":"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","file":"FieldConfigurationsService.js","sourcesContent":["/// <reference path=\"../../app.ts\" />\r\n/// <reference path=\"../../commons.ts\" />\r\n/// <reference path=\"../../models/fieldconfigurations.ts\" />\r\n/// <reference path=\"../../models/services.ts\" />\r\n/// <reference path=\"../../../scripts/typings/angularjs/angular-resource.d.ts\" />\r\n\r\nmodule AngularTablesDataManagerApp.Services {\r\n    import ngr = ng.resource;\r\n    import commons = AngularTablesDataManagerApp.Commons;\r\n    import models = AngularTablesDataManagerApp.Models;\r\n    import services = AngularTablesDataManagerApp.Services;\r\n\r\n    export interface IFieldConfigurationsResourceClass extends ngr.IResourceClass<ngr.IResource<models.IFieldConfiguration>> {\r\n        create(zip: models.IFieldConfiguration): ngr.IResource<models.IFieldConfiguration>;\r\n    }\r\n\r\n    export class FieldConfigurationsService {\r\n        private resource: IFieldConfigurationsResourceClass;\r\n        private $q: ng.IQService;\r\n        private $filter: ng.IFilterService;\r\n        private metadataService: services.MetadataService;\r\n        private entitySet: string = 'FieldConfigurations';\r\n        private fieldConfigurations: Array<models.IFieldConfiguration>;\r\n\r\n        constructor($resource: ngr.IResourceService, $q: ng.IQService, $filter: ng.IFilterService, metadataService: services.MetadataService) {\r\n            this.$q = $q;\r\n            this.$filter = $filter;\r\n            this.metadataService = metadataService;\r\n\r\n            this.resource = <IFieldConfigurationsResourceClass>$resource('/odata/' + this.entitySet + \"(guid':key')\", { key: '@Id' }, {\r\n                get: { method: 'GET' },\r\n                create: { method: 'POST', isArray: false, url: '/odata/' + this.entitySet },\r\n                save: { method: 'PUT' },\r\n                query: { method: 'GET', isArray: false, url: '/odata/' + this.entitySet },\r\n                delete: { method: 'DELETE' }\r\n            });\r\n        }\r\n\r\n        public create(fieldConfiguration: models.IFieldConfiguration) {\r\n            return this.resource.create(fieldConfiguration);\r\n        }\r\n\r\n        public save(fieldConfiguration: models.IFieldConfiguration) {\r\n            if (fieldConfiguration.Id == commons.Constants.GuidEmpty) {\r\n                return this.resource.create(fieldConfiguration);\r\n            }\r\n            else {\r\n                return this.resource.save(fieldConfiguration);\r\n            }\r\n        }\r\n\r\n        public delete(fieldConfiguration: models.IFieldConfiguration) {\r\n            return this.resource.delete({ key: fieldConfiguration.Id });\r\n        }\r\n\r\n        public getFieldConfiguration(entityName: string, fieldName: string): ng.IPromise<string> {\r\n            var defer: ng.IDeferred<string> = this.$q.defer();\r\n            var vm = this;\r\n\r\n            if (this.fieldConfigurations == null) {\r\n                vm.resource.query().$promise.then((data: any) => {\r\n                    vm.fieldConfigurations = data[\"value\"];\r\n                    defer.resolve(vm.getFieldTipology(entityName, fieldName));\r\n                }, (error) => {\r\n                    defer.reject(error);\r\n                });\r\n            }\r\n            else {\r\n                //return <ng.IPromise<string>><any>defer.resolve(vm.getFieldTipology(entityName, fieldName));\r\n                defer.resolve(vm.getFieldTipology(entityName, fieldName));\r\n            }\r\n\r\n            return defer.promise;\r\n        }\r\n\r\n        private getFieldTipology(entityName: string, fieldName: string): string {\r\n            var fieldConfigurations: Array<models.IFieldConfiguration> = this.$filter('filter')(this.fieldConfigurations, { 'Entity': entityName, 'Field': fieldName });\r\n            if (fieldConfigurations.length > 0) {\r\n                return fieldConfigurations[0].Tipology;\r\n            }\r\n            else {\r\n                return '';\r\n            }\r\n        }\r\n\r\n        static factory() {\r\n            return (r: ngr.IResourceService, $q: ng.IQService, $filter: ng.IFilterService, MetadataService: services.MetadataService) => new FieldConfigurationsService(r, $q, $filter, MetadataService);\r\n        }\r\n    }\r\n\r\n    AngularTablesDataManager.module.factory('FieldConfigurationsService', ['$resource', '$q', '$filter', 'MetadataService', FieldConfigurationsService.factory()]);\r\n}\r\n"]}
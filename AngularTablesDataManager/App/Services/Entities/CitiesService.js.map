{"version":3,"sources":["Services/Entities/CitiesService.ts"],"names":[],"mappings":"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","file":"CitiesService.js","sourcesContent":["/// <reference path=\"../../app.ts\" />\r\n/// <reference path=\"../../commons.ts\" />\r\n/// <reference path=\"../../models/cities.ts\" />\r\n/// <reference path=\"../../models/services.ts\" />\r\n/// <reference path=\"../gridservice.ts\" />\r\n/// <reference path=\"../../../scripts/typings/angularjs/angular-resource.d.ts\" />\r\n\r\nmodule AngularTablesDataManagerApp.Services {\r\n    import ngr = ng.resource;\r\n    import commons = AngularTablesDataManagerApp.Commons;\r\n    import models = AngularTablesDataManagerApp.Models;\r\n    import services = AngularTablesDataManagerApp.Services;\r\n\r\n    export interface ICitiesResourceClass extends ngr.IResourceClass<ngr.IResource<models.ICity>> {\r\n        create(city: models.ICity): ngr.IResource<models.ICity>;\r\n    }\r\n\r\n    export class CitiesService extends services.GridService {\r\n        private resource: ICitiesResourceClass;\r\n        private $q: ng.IQService;\r\n\r\n        constructor($resource: ngr.IResourceService, $q: ng.IQService, metadataService: services.MetadataService) {\r\n            super('Cities', 'City', metadataService);\r\n\r\n            this.$q = $q;\r\n            this.metadataService = metadataService;\r\n\r\n            this.resource = <ICitiesResourceClass>$resource('/odata/' + this.entitySet + \"(guid':key')\", { key: '@Id' }, {\r\n                get: { method: 'GET' },\r\n                create: { method: 'POST', isArray: false, url: '/odata/' + this.entitySet  },\r\n                save: { method: 'PUT' },\r\n                query: { method: 'GET', isArray: false, url: '/odata/' + this.entitySet },\r\n                delete: { method: 'DELETE' }\r\n            });\r\n        }\r\n\r\n        public create(city: models.ICity) {\r\n            return this.resource.create(city);\r\n        }\r\n\r\n        public save(city: models.ICity) {\r\n            if (city.Id == commons.Constants.GuidEmpty) {\r\n                return this.resource.create(city);\r\n            }\r\n            else {\r\n                return this.resource.save(city);\r\n            }\r\n        }\r\n\r\n        public delete(city: models.ICity) {\r\n            return this.resource.delete({ key: city.Id });\r\n        }\r\n\r\n        public getGridData(Columns: Array<models.MetadataProperty>): ng.IPromise<Array<models.Row>> {\r\n            var datas: Array<models.ICity>;\r\n            var defer: ng.IDeferred<any> = this.$q.defer();\r\n\r\n            this.resource.query().$promise.then((data: any) => {\r\n                datas = data[\"value\"];\r\n\r\n                return defer.resolve(super.getData(Columns, <Array<models.IEntity>>datas));\r\n            }, (error) => {\r\n                return defer.reject(error);\r\n            });\r\n\r\n            return defer.promise;\r\n        }\r\n\r\n        public createGridData(Columns: Array<models.MetadataProperty>): models.Row {\r\n            var entity: models.ICity = { Id: commons.Constants.GuidEmpty, Name: '' };\r\n\r\n            return super.createData(Columns, entity);\r\n        }\r\n\r\n        public saveGridData(item: models.Row) {\r\n            var defer: ng.IDeferred<any> = this.$q.defer();\r\n\r\n            this.save(<models.ICity>super.saveData(item)).$promise.then((data: any) => {\r\n                item.Entity = data;\r\n                return defer.resolve(item);\r\n            }, (error) => {\r\n                return defer.reject(error);\r\n            });\r\n\r\n            return defer.promise;\r\n        }\r\n\r\n        public deleteGridData(item: models.Row) {\r\n            var defer: ng.IDeferred<any> = this.$q.defer();\r\n\r\n            this.delete(<models.ICity>item.Entity).$promise.then((data: any) => {\r\n                return defer.resolve(item);\r\n            }, (error) => {\r\n                return defer.reject(error);\r\n            });\r\n\r\n            return defer.promise;\r\n        }\r\n\r\n        static factory() {\r\n            return (r: ngr.IResourceService, $q: ng.IQService, MetadataService: services.MetadataService) => new CitiesService(r, $q, MetadataService);\r\n        }\r\n    }\r\n\r\n    AngularTablesDataManager.module.factory('CitiesService', ['$resource', '$q', 'MetadataService', CitiesService.factory()]);\r\n}\r\n"]}